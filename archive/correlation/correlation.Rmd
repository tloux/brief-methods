---
title: "Correlation"
output:
  tufte::tufte_handout: default
  tufte::tufte_html: default
date: 'Date: `r format(Sys.time(), "%Y-%m-%d")`'
---

```{r, echo=FALSE, warning=FALSE}
library(knitr)
library(tufte)
load('../brfss_2015_subset.RData')
```


```{r set-options, echo=FALSE, cache=FALSE}
options(width=100)
```


# What it is

Correlation measures the strength of the relationship between two variables. Specifically, Pearson's correlation coefficient measures the strength of the linear relationship/trend between the variables. It is important to remember this is not the slope of the linear relationship, bur how colsely the points fall to a straight line.


# When to use it

Technically, correlation can be computed for any two numeric variables. However, is it important to remember Pearson's correlation coefficient only measures the strength of the *linear* trend. Other trends (exponential, cyclical, etc.) may be lost or obscured. It is always a good idea to plot hte data prior to computing the correlation coefficient. In addition, in order for confidence intervals and hypothesis tests to work appropriately, both variables should be approximately normal.


# How to use it

The Pearson correlation coefficient can be computed in R using the `cor()` function:

```{r}
cor(x=d$height, y=d$weight)
```

To run a hypothesis test or create a confidence interval, use the function `cor.test()`. The results R gives are for the hypothesis test $H_0: \rho=0$ against the given alternative (options `"two.sided"`, `"less"`, and `"greater"`, with default set to `"two.sided"`):

```{r}
cor.test(x=d$height, y=d$weight)
```

Correlations range in value from -1 to 1, with $\pm 1$ indicating perfect correlation (points fall in a perfect line) and 0 indicating the variables are uncorrelated (no linear trend). As a general rule of thumb, we can use the following cutoffs for strength:

- $|r| < 0.3$: weak
- $0.3 < |r| < 0.7$: moderate
- $|r| > 0.7$: strong


# Why it works

The formula for computing Pearson's correlation coefficient is

$$
r = \frac{\frac{1}{n-1}\sum_i(x_i - \bar{x})(y_i - \bar{y})}{s_x \cdot s_y}
$$

The denominator of the right hand side is the product of the standard deviations of $x$ and $y$, and the numerator is known as the **covariance** between $x$ and $y$.

```{r, echo=FALSE, fig.margin=TRUE, fig.cap="Scatterplot with quadrants defined by variable means."}
par(mar=c(4,3,2,2))
plot(weight ~ height, data=d, col='grey', frame=FALSE)
abline(h=mean(d$weight), lty=2)
abline(v=mean(d$height), lty=2)
axis(side=3, at=mean(d$height), label=expression(bar(x)))
axis(side=4, at=mean(d$weight), label=expression(bar(y)), las=2)
```

Let's focus on the numerator (covariance): It is helpful to consider where the means of the two variables in the scatterplot are located, as in Figure 1. For points in the upper right quadrant, $x_i > \bar{x}$ and $y_i > \bar{y}$, so that $x_i - \bar{x} > 0$ and $y_i - \bar{y} > 0$. Thus, the product $(x_i - \bar{x})(y_i - \bar{y})$ is greater than 0 and these points add a positive amount to the correlation numerator. Similarly, points in the lower left quadrant add a positive amount to the covariance^[$x_i < \bar{x}$ and $y_i < \bar{y}$, so $x_i - \bar{x}$ and $y_i - \bar{y}$ are both negative, making $(x_i - \bar{x})(y_i - \bar{y})$ positive.]. So, points in the upper right and lower left quadrants increase the covariance (and hence the correlation) and the more points in these quadrants, the more positive the correlation. By similar argument, points in the upper left and lower right quadrants add negative values, decreasing the covariance (correlation)^[If, say, $x_i > \bar{x}$ but $y_i < \bar{y}$, then $x_i - \bar{x}$ will be positive but $y_i - \bar{y}$ will be negative, and their product will be negative.]. More points in these two quadrants will lead to a more negative correlation.