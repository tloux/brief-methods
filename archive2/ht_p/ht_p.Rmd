---
title: "Hypothesis test for population proportion"
output:
  tufte::tufte_handout: default
  tufte::tufte_html: default
date: 'Date: `r format(Sys.time(), "%Y-%m-%d")`'
---

```{r, echo=FALSE, warning=FALSE}
library(knitr)
library(tufte)
load('../brfss_2015_subset.RData')
```

# What it is

A hypothesis test for $p$ determines whether observed data is consistent with a hypothesized population proportion.


# When to use it

The data conditions for this hypothesis test are similar to those for the confidence interval for $p$ (a fixed sample of independent binary outcomes). In addition, there should be a specific numeric value of interest (e.g., $p = 0.5$, or a CDC vaccination coverage goal) to use as the null hypothesis. If there is no specific value of interest, a confidence interval is probably more appropriate.


# How to use it

As with all hypothesis tests, begin with explicitly stating hypotheses. For this test, there are three options for the null hypothesis: $H_0:p=p_0$, $H_0: p \leq p_0$, or $H_0: p \geq p_0$, where $p_0$ is the proportion of interest. A significance level, $\alpha$, should also be chosen, usually 0.05.

In R, use the function `binom.test()`. Like with the confidence interval for $p$, we need to get the sample size and the number of successes. Suppose we want test whether the data is approximately 50% female^[This is a common way to test representativeness: if the data is not consistent with a population with 50% females, the sample is potentially biased.]. The null hypothesis would be $H_0: p = 0.5$, so we set the inputs `p=0.5` and `alternative='two.sided'` for the test:

```{r}
table(d$sex)

binom.test(x=267, n=500, p=0.5, alternative='two.sided', conf.level=0.95)
```

We see that about 53% of the sample is female, and this is within reason for a sample of this size if the true proportion is 0.5 ($p-value = 0.14$)^[See also that the confidence interval covers the 0.5.]. Had the p-value been less than 0.05 (our chosen $\alpha$), we would have had evidence that the data was not consistent with a 50/50 gender split.


# Why it works

The hypothesis test beging by assuming $p = p_0$. If this is actually true, then the Central Limit Theorem tells us that $\hat{p}$ is normaly distributed^[Using mathematical shorthand, $\hat{p} \sim \mathcal{N}\left(p_0, \frac{p_0(1-p_0)}{n}\right)$] with mean $p_0$ and variance $\frac{p_0(1-p_0)}{n}$. Then we know what values of $\hat{p}$ to expect from a sample.

Since about 95% of values are within 2 standard errors of $p_0$, anything outside the range $p_0 - 2 \sqrt{\frac{p_0(1-p_0)}{n}}$ to $p_0 + 2 \sqrt{\frac{p_0(1-p_0)}{n}}$ is "unexpected" and can be taken as evidence that $p \neq p_0$. These values of $\hat{p}$ far from $p_0$ correspond exactly to values of $\hat{p}$ that will give small p-values.

```{r, echo=FALSE, fig.height=3, fig.width=5}
par(mar=c(4,0,2,0))
plot(dnorm, from=-3.5, to=3.5, lwd=2, 
     main=expression(paste('Sampling distribution of ', hat(p))), 
     xaxt='n', xlab='', 
     yaxt='n', ylab='', 
     frame=FALSE)
abline(h=0, col='grey')

axis(side=1, at=c(-2,0,2), 
     labels=c(expression(p[0]-2*sqrt(frac(p[0](1-p[0]), n))), 
              expression(p[0]), 
              expression(p[0]+2*sqrt(frac(p[0](1-p[0]), n)))), 
     lwd=0, line=1)

lines(x=rep(-2,2), y=c(0,dnorm(-2)))
lines(x=rep(2,2), y=c(0,dnorm(2)))
points(x=0, y=0, pch=17)

text(x=-2.9, y=0.08, labels='p-value < 0.05')
text(x=2.9, y=0.08, labels='p-value < 0.05')
```
